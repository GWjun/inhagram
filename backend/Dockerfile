FROM node:20.15.1

ARG PROTOCOL
ARG HOST
ARG JWT_SECRET
ARG HASH_ROUNDS
ARG ACCESS_EXPIRE
ARG REFRESH_EXPIRE
ARG DB_HOST
ARG DB_PORT
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_DATABASE

ENV PROTOCOL=$PROTOCOL
ENV HOST=$HOST
ENV JWT_SECRET=$JWT_SECRET
ENV HASH_ROUNDS=$HASH_ROUNDS
ENV ACCESS_EXPIRE=$ACCESS_EXPIRE
ENV REFRESH_EXPIRE=$REFRESH_EXPIRE
ENV DB_HOST=$DB_HOST
ENV DB_PORT=$DB_PORT
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_DATABASE=$DB_DATABASE

WORKDIR /app

COPY package.json pnpm-lock.yaml ./

RUN npm install -g pnpm

RUN pnpm install

COPY . .

EXPOSE 8080

CMD ["pnpm", "start"]
